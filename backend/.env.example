# BlockSecure Backend Configuration

## Environment Variables

Create a `.env` file in the backend directory with the following:

```
# Server Configuration
PORT=5000
NODE_ENV=development

# Blockchain Configuration
BLOCKCHAIN_RPC=http://localhost:7545
CONTRACT_ADDRESS=0x...your_contract_address...
PRIVATE_KEY=0x...your_private_key...

# CORS Configuration
CORS_ORIGIN=http://localhost:3000

# File Upload Configuration
MAX_FILE_SIZE=104857600
UPLOAD_DIR=./uploads
```

## Setup Instructions

### 1. Install Dependencies
```bash
npm install
```

### 2. Configure Environment Variables
Create a `.env` file and add your blockchain and contract details.

### 3. Start the Server
```bash
npm start
# or for development with auto-reload
npm run dev
```

## API Endpoints

### File Management

#### Upload File
- **POST** `/api/upload`
- Body: `multipart/form-data`
  - `file`: The encrypted file
  - `fileName`: Original file name
  - `owner`: Wallet address (owner)
  - `fileHash`: SHA-256 hash
  - `encryptionKey`: Encryption key

#### Download File
- **GET** `/api/file/:fileId`
- Returns the encrypted file for download

#### Get File Metadata
- **GET** `/api/file-metadata/:fileId`
- Returns file metadata (hash, owner, timestamp, etc.)

#### Get User Files
- **GET** `/api/user-files/:userAddress`
- Returns all files uploaded by a user

#### Verify File
- **POST** `/api/verify`
- Body: `multipart/form-data`
  - `file`: The file to verify
  - `blockchainHash`: The original hash from blockchain

### Blockchain Integration

#### Store Hash on Blockchain
- **POST** `/api/store-hash`
- Body: JSON
  - `fileHash`: SHA-256 hash
  - `userAddress`: Wallet address

#### Verify Hash on Blockchain
- **GET** `/api/verify-blockchain/:fileHash`
- Checks if hash exists on blockchain

#### Grant File Access
- **POST** `/api/grant-access`
- Body: JSON
  - `fileId`: File ID
  - `userAddress`: User to grant access to

#### Check Access Permission
- **GET** `/api/check-access/:fileId/:userAddress`
- Checks if user has access to file

#### Get Network Info
- **GET** `/api/network-info`
- Returns blockchain network details

## Folder Structure

```
backend/
├── server.js              # Main server file
├── package.json           # Dependencies
├── .env                   # Environment variables (create this)
├── uploads/               # Uploaded files directory
├── routes/
│   ├── fileRoutes.js     # File management endpoints
│   └── blockchainRoutes.js # Blockchain integration
└── utils/
    └── crypto.js          # Cryptography utilities
```

## Security Notes

- Never commit `.env` file to version control
- Keep `PRIVATE_KEY` secure and never share it
- Use HTTPS in production
- Implement rate limiting for API endpoints
- Validate all inputs on the server side
